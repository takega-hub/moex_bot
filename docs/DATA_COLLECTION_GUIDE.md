# Руководство по сбору исторических данных

## Настройка инструментов

Инструменты для торговли настраиваются в файле `.env`:

```env
TRADING_INSTRUMENTS=VBH6,SRH6,GLDRUBF
```

Или можно указать инструменты при запуске скрипта.

## Запуск сбора данных

### Базовый запуск

```bash
python collect_historical_data.py
```

Скрипт использует инструменты из `.env` или значения по умолчанию: `VBH6`, `SRH6`, `GLDRUBF`

### Указание инструментов вручную

```bash
python collect_historical_data.py VBH6 SRH6 GLDRUBF
```

### Настройка периода сбора

В `.env` можно указать:

```env
DATA_COLLECTION_DAYS=180      # Количество дней истории (по умолчанию 180)
DATA_COLLECTION_INTERVAL=15min # Интервал свечей (15min, 1hour, 4hour, day)
```

## Что делает скрипт

1. **Поиск инструментов**: Находит каждый инструмент по тикеру через Tinkoff API
2. **Проверка существующих данных**: Проверяет, какие данные уже есть в CSV файлах
3. **Сбор недостающих данных**: Собирает только недостающие периоды
4. **Обновление до актуальных данных**: Обновляет данные до текущего момента
5. **Сохранение**: Сохраняет данные в CSV файлы в папке `ml_data/`

## Структура сохраненных данных

После сбора данных в папке `ml_data/` будут созданы:

- `VBH6_15_cache.csv` - кэш данных для VBH6 с интервалом 15 минут
- `SRH6_15_cache.csv` - кэш данных для SRH6
- `GLDRUBF_15_cache.csv` - кэш данных для GLDRUBF
- `instruments.csv` - справочник инструментов (FIGI, ticker, name)

## Пример вывода

```
======================================================================
HISTORICAL DATA COLLECTION
======================================================================
Instruments: VBH6, SRH6, GLDRUBF
Period: 180 days
Interval: 15min
======================================================================

[1/3] Processing VBH6...
----------------------------------------------------------------------
1. Finding instrument VBH6...
   ✓ Found: VTBR-3.26 ВТБ (FIGI: FUTVTBR03260)

2. Checking existing data...
   No existing data found. Will collect full range.

3. Collecting candles...
   ✓ Collected 1234 candles

4. Updating to latest data...
   ✓ Updated with 12 new candles

5. Summary for VBH6:
   Total candles: 1246
   Date range: 2025-08-12 to 2026-02-09
   ✓ VBH6 data collection completed
```

## Автоматический сбор данных

Бот автоматически собирает данные при запуске:
- При старте собираются 30 дней истории для всех активных инструментов
- Фоновый процесс обновляет данные каждый час
- Перед генерацией сигналов данные обновляются автоматически

## Ручной сбор данных

Если нужно собрать данные вручную:

```bash
# Собрать данные для всех инструментов из .env
python collect_historical_data.py

# Собрать данные для конкретных инструментов
python collect_historical_data.py VBH6 SRH6

# Собрать данные за больший период (изменить в .env)
# DATA_COLLECTION_DAYS=365
python collect_historical_data.py
```
